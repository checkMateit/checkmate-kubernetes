kube-prometheus-stack:
  crds:
    enabled: false
  prometheusOperator:
    admissionWebhooks:
      enabled: false
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi

  grafana:
    enabled: true
    adminPassword: admin
    service:
      type: ClusterIP
    resources:
      requests:
        cpu: 100m
        memory: 192Mi
      limits:
        cpu: 500m
        memory: 384Mi
    ingress:
      enabled: true
      ingressClassName: traefik
      hosts:
        - grafana.checkmate
      path: /
      pathType: Prefix
    persistence:
      enabled: true
      size: 10Gi
    additionalDataSources:
      - name: Loki
        uid: loki
        type: loki
        access: proxy
        url: http://monitoring-loki-gateway.monitoring.svc.cluster.local
        isDefault: false
      - name: Alertmanager
        uid: alertmanager
        type: alertmanager
        access: proxy
        url: http://monitoring-kube-prometheus-alertmanager.monitoring:9093
        jsonData:
          implementation: prometheus
          handleGrafanaManagedAlerts: false
    sidecar:
      datasources:
        enabled: true
      dashboards:
        enabled: true
        label: grafana_dashboard
        labelValue: "1"

  prometheus:
    enabled: true
    prometheusSpec:
      retention: 7d
      scrapeInterval: 30s
      enableRemoteWriteReceiver: true
      resources:
        requests:
          cpu: 200m
          memory: 512Mi
        limits:
          cpu: "1"
          memory: 1Gi

  alertmanager:
    enabled: true
    alertmanagerSpec:
      version: v0.28.0
      replicas: 1
      resources:
        requests:
          cpu: 50m
          memory: 128Mi
        limits:
          cpu: 300m
          memory: 256Mi
      alertmanagerConfigMatcherStrategy:
        type: None
      alertmanagerConfigSelector:
        matchLabels:
          release: monitoring
      alertmanagerConfigNamespaceSelector: {}

loki:
  loki:
    auth_enabled: false
    commonConfig:
      replication_factor: 1
    storage:
      type: filesystem
      bucketNames:
        chunks: chunks
        ruler: ruler
        admin: admin
    schemaConfig:
      configs:
        - from: "2024-01-01"
          store: tsdb
          object_store: filesystem
          schema: v13
          index:
            prefix: loki_index_
            period: 24h
    storage_config:
      filesystem:
        directory: /var/loki/chunks
      tsdb_shipper:
        active_index_directory: /var/loki/tsdb-index
        cache_location: /var/loki/tsdb-cache
  deploymentMode: SingleBinary
  singleBinary:
    replicas: 1
    resources:
      requests:
        cpu: 200m
        memory: 384Mi
      limits:
        cpu: "1"
        memory: 768Mi
  backend:
    replicas: 0
  read:
    replicas: 0
  write:
    replicas: 0
  test:
    enabled: false
  chunksCache:
    enabled: false
  resultsCache:
    enabled: false

promtail:
  resources:
    requests:
      cpu: 30m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 160Mi
  serviceMonitor:
    enabled: true
    labels:
      release: monitoring
  config:
    snippets:
      pipelineStages:
        - cri: {}
        - match:
            selector: '{namespace=~".+"}'
            stages:
              - regex:
                  expression: '.* ERROR [0-9]+ --- .*'
              - metrics:
                  spring_error_logs_total:
                    type: Counter
                    description: "Spring error log lines"
                    config:
                      action: inc
    clients:
      - url: http://monitoring-loki.monitoring.svc.cluster.local:3100/loki/api/v1/push
